<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Label Check PIRT</title>
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
<style>
    body { font-family: Arial; padding: 20px; }
    .box { padding: 15px; border: 1px solid #ddd; margin-top: 20px; border-radius: 8px; }
    .success { color: green; }
    .fail { color: red; }
</style>
</head>
<body>

<h2>Cek Label Pangan Otomatis (PIRT)</h2>
<p>Upload foto label, sistem akan membaca teks dan menilai kelengkapannya.</p>

<input type="file" id="upload" accept="image/*"><br><br>

<div class="box">
    <h3>Teks Hasil OCR:</h3>
    <pre id="output" style="white-space: pre-wrap;"></pre>
</div>

<div id="result" class="box"></div>

<script>
document.getElementById("upload").addEventListener("change", function() {
    const file = this.files[0];
    if (!file) return;

    Tesseract.recognize(file, "eng", { logger: m => console.log(m) })
    .then(({ data: { text } }) => {
        document.getElementById("output").textContent = text;

        let lines = text.split("\n")
                        .map(a => a.trim())
                        .filter(a => a.length > 0);

        // ------------------------------
        // 1. Cari NAMA PRODUK = tulisan terbesar
        // (biasanya baris terpanjang)
        // ------------------------------
        let namaProduk = lines.reduce((a,b) => b.length > a.length ? b : a, "");

        // ------------------------------
        // 2. Cari NAMA DAGANG = baris paling atas
        // ------------------------------
        let namaDagang = lines.length > 0 ? lines[0] : "Tidak ditemukan";

        // ------------------------------
        // 3. Cari produsen berdasarkan kata kunci
        // ------------------------------
        let produsen = "Tidak ditemukan";
        for (let ln of lines) {
            if (/diproduksi|produced|manufactured|oleh/i.test(ln)) {
                produsen = ln;
                break;
            }
        }

        // ------------------------------
        // 4. Tampilkan hasil + cek kelengkapan
        // ------------------------------
        let html = `<h3>Hasil Analisis Label</h3>`;
        html += `<p><b>Nama Produk:</b> ${namaProduk || "Tidak ditemukan"}</p>`;
        html += `<p><b>Nama Dagang:</b> ${namaDagang || "Tidak ditemukan"}</p>`;
        html += `<p><b>Produsen:</b> ${produsen}</p>`;

        html += `<h3>Status Kelengkapan</h3><ul>`;

        function cek(label, value) {
            if (!value || value === "Tidak ditemukan") {
                html += `<li class="fail">❌ ${label} belum ada</li>`;
                return false;
            } else {
                html += `<li class="success">✔ ${label} lengkap</li>`;
                return true;
            }
        }

        let c1 = cek("Nama Produk", namaProduk);
        let c2 = cek("Nama Dagang", namaDagang);
        let c3 = cek("Produsen", produsen);

        html += `</ul>`;

        // ------------------------------
        // 5. Jika belum lengkap → arahkan ke Canva
        // ------------------------------
        if (!c1 || !c2 || !c3) {
            html += `
                <div style="margin-top:20px;">
                    <a href="https://www.canva.com/design/create" 
                       target="_blank" 
                       style="background:#ff007b;color:white;padding:10px 20px;border-radius:6px;text-decoration:none;">
                       Edit Label di Canva
                    </a>
                </div>`;
        }

        document.getElementById("result").innerHTML = html;
    });
});
</script>

</body>
</html>
